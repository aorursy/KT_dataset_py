# This Python 3 environment comes with many helpful analytics libraries installed

# It is defined by the kaggle/python docker image: https://github.com/kaggle/docker-python

# For example, here's several helpful packages to load in 



import numpy as np # linear algebra

import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)



# Input data files are available in the "../input/" directory.

# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory



import os

for dirname, _, filenames in os.walk('/kaggle/input'):

    for filename in filenames:

        print(os.path.join(dirname, filename))



# Any results you write to the current directory are saved as output.
from IPython.display import Image

from IPython.core.display import HTML 

Image(url= "data:image/jpeg;base64,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")

import tensorflow as tf

import tensorflow.keras as keras

import tensorflow.keras.layers as layers

print(tf.__version__)  ##查看版本
(x_train, y_train), (x_test, y_test) = keras.datasets.mnist.load_data()  ##导入数据集
##数据预处理



x_train = tf.expand_dims(x_train.astype('float32'), -1) / 255.0

x_test = tf.expand_dims(x_test.astype('float32'),-1) / 255.0



print(x_train.shape, ' ', y_train.shape)

print(x_test.shape, ' ', y_test.shape)
from IPython.display import Image

from IPython.core.display import HTML 

Image(url= "https://lh3.googleusercontent.com/proxy/nma4KDvmNxKAip4RAqqJ-jWDhgAeE4Ngv1M7FA1JoZoAKa62CgKwL-d5EKK9gmDYFXHgDfFeu5m-5M6KxH-KiPqGoRzDDPas1Fa6tLnAMJK_iG-xtv87gFnk_4W1xIZFXopMA-GjU-_ZStNPnhjYWcTbjNNRF146TPifTIsZkC9xedo-wVLruOB50SvBt5R32KZKznchx4r7PblSeV39YPttEMLIMMcA8Ca-Ug")





inputs = layers.Input(shape=(x_train.shape[1], x_train.shape[2], x_train.shape[3]), name='inputs')

print(inputs.shape)

code = layers.Conv2D(16, (3,3), activation='relu', padding='same')(inputs)

code = layers.MaxPool2D((2,2), padding='same')(code)

print(code.shape)

decoded = layers.Conv2D(16, (3,3), activation='relu', padding='same')(code)

decoded = layers.UpSampling2D((2,2))(decoded)  ##上采样

print(decoded.shape)

outputs = layers.Conv2D(1, (3,3), activation='sigmoid', padding='same')(decoded)

print(outputs.shape)

auto_encoder = keras.Model(inputs, outputs)
##训练模型

auto_encoder.compile(optimizer=keras.optimizers.Adam(),

                    loss=keras.losses.BinaryCrossentropy())





##画模型流程图

keras.utils.plot_model(auto_encoder, show_shapes=True)
#提前停止

early_stop = keras.callbacks.EarlyStopping(patience=2, monitor='loss')

##训练模型

history = auto_encoder.fit(x_train,x_train, batch_size=64, epochs=5, validation_split=0.1,validation_freq=10,

                callbacks=[early_stop])
import matplotlib.pyplot as plt

decoded = auto_encoder.predict(x_test)

n = 5

plt.figure(figsize=(10, 4))

for i in range(n):

    # display original

    ax = plt.subplot(2, n, i+1)

    plt.imshow(tf.reshape(x_test[i+1],(28, 28)))

    plt.gray()

    ax.get_xaxis().set_visible(False)

    ax.get_yaxis().set_visible(False)



    # display reconstruction

    ax = plt.subplot(2, n, i + n+1)

    plt.imshow(tf.reshape(decoded[i+1],(28, 28)))

    plt.gray()

    ax.get_xaxis().set_visible(False)

    ax.get_yaxis().set_visible(False)

plt.show()
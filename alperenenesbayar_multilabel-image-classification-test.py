import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from matplotlib import pyplot as plt
#keras imports
from keras.utils import to_categorical
from keras.models import Sequential
from keras.layers import Conv2D, MaxPooling2D
from keras.layers import Dense, Dropout, Flatten
train_data_file = "/kaggle/input/fashionmnist/fashion-mnist_train.csv"
test_data_file = "/kaggle/input/fashionmnist/fashion-mnist_test.csv"
train_data = pd.read_csv(train_data_file)
test_data = pd.read_csv(test_data_file)
print("train data shape is {}".format(train_data.shape))
print("test data shape is {}".format(test_data.shape))
def get_xy(data):
    y = to_categorical(data['label'].values)
    x = data.drop(columns=['label']).to_numpy().reshape((data.shape[0], int(np.sqrt(data.shape[1])), int(np.sqrt(data.shape[1])), 1))/255
    return x, y
#getting train data
X, y = get_xy(train_data)
X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42, test_size=0.2)
print("X_train shape {}".format(X_train.shape))
print("X_test shape {}".format(X_test.shape))
print("y_train shape {}".format(y_train.shape))
print("y_test shape {}".format(y_test.shape))
#Build model
model = Sequential()
model.add(Conv2D(32, kernel_size=(3,3), activation='relu', input_shape=(28,28,1)))
model.add(Conv2D(64, (3, 3), activation='relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Dropout(0.25))
model.add(Flatten())
model.add(Dense(128, activation='relu'))
model.add(Dropout(0.5))
model.add(Dense(10, activation='softmax'))
model.compile(loss='categorical_crossentropy',optimizer='Adam',metrics=['accuracy'])
model.fit(X_train, y_train, epochs=10, validation_data=(X_test, y_test))
img_test, label_test = get_xy(test_data)
scores = model.evaluate(img_test, label_test, verbose=0)
print("Accuracy: %.2f%%" % (scores[1]*100))
loadImage = np.array([[[[0.0], [0.0], [0.0039215686274509665], [0.0117647058823529], [0.0], [0.0039215686274509665], [0.015686274509804088], [0.0], [0.0], [0.0], [0.015686274509804088], [0.0], [0.0], [0.007843137254901933], [0.0039215686274509665], [0.0], [0.0], [0.015686274509804088], [0.03529411764705881], [0.0], [0.0039215686274509665], [0.007843137254901933], [0.0], [0.0], [0.0], [0.0], [0.0117647058823529], [0.0]], [[0.0039215686274509665], [0.0], [0.0117647058823529], [0.0], [0.0117647058823529], [0.015686274509804088], [0.0], [0.0], [0.007843137254901933], [0.0], [0.0], [0.0], [0.0], [0.007843137254901933], [0.019607843137254943], [0.0], [0.0117647058823529], [0.0039215686274509665], [0.0], [0.0], [0.0117647058823529], [0.0039215686274509665], [0.007843137254901933], [0.007843137254901933], [0.0117647058823529], [0.0039215686274509665], [0.0], [0.0039215686274509665]], [[0.0], [0.0], [0.0], [0.019607843137254943], [0.0], [0.0], [0.027450980392156876], [0.007843137254901933], [0.0], [0.03137254901960773], [0.0], [0.027450980392156876], [0.0], [0.0], [0.0039215686274509665], [0.019607843137254943], [0.0], [0.0], [0.027450980392156876], [0.4], [0.5725490196078431], [0.6627450980392157], [0.6941176470588235], [0.6862745098039216], [0.6392156862745098], [0.3882352941176469], [0.0], [0.0]], [[0.007843137254901933], [0.0], [0.007843137254901933], [0.0], [0.0039215686274509665], [0.0], [0.0], [0.0], [0.0], [0.0117647058823529], [0.0], [0.0], [0.0], [0.03137254901960773], [0.0039215686274509665], [0.0], [0.007843137254901933], [0.027450980392156876], [0.14901960784313728], [0.7137254901960784], [0.8509803921568627], [0.8901960784313725], [0.8980392156862745], [0.8745098039215686], [0.8470588235294118], [0.6784313725490196], [0.0862745098039216], [0.0]], [[0.0235294117647058], [0.0], [0.0235294117647058], [0.0], [0.0117647058823529], [0.019607843137254943], [0.0], [0.0117647058823529], [0.0039215686274509665], [0.0], [0.015686274509804088], [0.050980392156862786], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.16078431372549018], [0.7647058823529411], [0.8313725490196078], [0.8431372549019608], [0.8549019607843138], [0.8274509803921568], [0.8], [0.7607843137254902], [0.11764705882352933], [0.0]], [[0.0], [0.007843137254901933], [0.0], [0.25098039215686274], [0.5450980392156863], [0.7607843137254902], [0.7764705882352941], [0.04313725490196085], [0.0], [0.04313725490196085], [0.2784313725490195], [0.6431372549019607], [0.4352941176470587], [0.09411764705882342], [0.0117647058823529], [0.0039215686274509665], [0.015686274509804088], [0.0], [0.22352941176470587], [0.7843137254901961], [0.8156862745098039], [0.8352941176470589], [0.8705882352941177], [0.8352941176470589], [0.8117647058823529], [0.7843137254901961], [0.1333333333333332], [0.0]], [[0.019607843137254943], [0.0], [0.2705882352941176], [0.8196078431372549], [0.9294117647058824], [0.8862745098039215], [0.9019607843137255], [0.14509803921568631], [0.0235294117647058], [0.039215686274509776], [0.6627450980392157], [0.9411764705882353], [0.8901960784313725], [0.7137254901960784], [0.050980392156862786], [0.0], [0.0], [0.0], [0.34901960784313724], [0.8235294117647058], [0.803921568627451], [0.8274509803921568], [0.8862745098039215], [0.8588235294117647], [0.807843137254902], [0.8549019607843138], [0.2666666666666666], [0.0]], [[0.0], [0.039215686274509776], [0.7686274509803921], [0.9568627450980393], [0.8352941176470589], [0.8941176470588236], [0.8980392156862745], [0.8117647058823529], [0.30980392156862735], [0.6509803921568628], [0.8901960784313725], [0.8745098039215686], [0.8980392156862745], [0.9176470588235294], [0.37254901960784315], [0.0], [0.0039215686274509665], [0.0], [0.39607843137254906], [0.8235294117647058], [0.8117647058823529], [0.8549019607843138], [0.9137254901960784], [0.8549019607843138], [0.8274509803921568], [0.8274509803921568], [0.29803921568627456], [0.007843137254901933]], [[0.0], [0.35686274509803917], [0.9254901960784314], [0.8927188235294118], [0.8691894117647059], [0.8882317647058824], [0.8529376470588236], [0.9196043137254902], [0.9117611764705882], [0.8843101960784314], [0.8960749019607843], [0.9123266666666667], [0.8770325490196078], [0.9019607843137255], [0.8235294117647058], [0.07450980392156858], [0.0], [0.0039215686274509665], [0.45882352941176463], [0.8313725490196078], [0.7882352941176471], [0.9019607843137255], [0.7411764705882353], [0.8941176470588236], [0.8179411764705882], [0.845392156862745], [0.3042156862745098], [0.0]], [[0.0980392156862745], [0.7921568627450981], [0.8862745098039215], [0.9397776470588235], [0.9084050980392157], [0.8882317647058824], [0.9235258823529412], [0.8843101960784314], [0.8803886274509803], [0.8921533333333334], [0.8960749019607843], [0.8848756862745099], [0.8887972549019608], [0.9098039215686274], [0.9215686274509804], [0.5019607843137255], [0.0], [0.019607843137254943], [0.5333333333333333], [0.8313725490196078], [0.8431372549019608], [0.7372549019607844], [0.1568627450980391], [0.8313725490196078], [0.8257843137254902], [0.845392156862745], [0.25715686274509797], [0.003088235294117614]], [[0.4549019607843138], [0.9568627450980393], [0.8823529411764706], [0.8613462745098039], [0.8848756862745099], [0.9196043137254902], [0.8843101960784314], [0.9039180392156863], [0.9196043137254902], [0.9039180392156863], [0.8921533333333334], [0.8848756862745099], [0.9240913725490196], [0.8509803921568627], [0.8980392156862745], [0.9215686274509804], [0.22352941176470587], [0.0], [0.43137254901960786], [0.803921568627451], [0.8588235294117647], [0.8], [0.007843137254901933], [0.8627450980392157], [0.8257843137254902], [0.8179411764705882], [0.18264705882352938], [0.0]], [[0.3019607843137255], [0.7529411764705882], [0.9372549019607843], [0.8495815686274509], [0.7593854901960784], [0.766663137254902], [0.9078396078431372], [0.8725454901960784], [0.8725454901960784], [0.8921533333333334], [0.8921533333333334], [0.7319345098039216], [0.7789933333333333], [0.9176470588235294], [0.9137254901960784], [0.7764705882352941], [0.22745098039215683], [0.007843137254901933], [0.3764705882352941], [0.8470588235294118], [0.8117647058823529], [0.7843137254901961], [0.05882352941176472], [0.8156862745098039], [0.8414705882352941], [0.7904901960784314], [0.13558823529411757], [0.0]], [[0.0], [0.11764705882352933], [0.6470588235294117], [0.7789933333333333], [0.7319345098039216], [0.8843101960784314], [0.8725454901960784], [0.9235258823529412], [0.9117611764705882], [0.8764670588235294], [0.9117611764705882], [0.7319345098039216], [0.7201698039215686], [0.8431372549019608], [0.596078431372549], [0.16078431372549018], [0.0], [0.03529411764705881], [0.3019607843137255], [0.8313725490196078], [0.8588235294117647], [0.7764705882352941], [0.04313725490196085], [0.7450980392156863], [0.861078431372549], [0.7630392156862745], [0.12774509803921574], [0.010098039215686194]], [[0.015686274509804088], [0.0], [0.04705882352941182], [0.7436992156862745], [0.84566], [0.8803886274509803], [0.9196043137254902], [0.8725454901960784], [0.9078396078431372], [0.8647023529411765], [0.8882317647058824], [0.8887972549019608], [0.8887972549019608], [0.580392156862745], [0.10588235294117654], [0.0], [0.0], [0.019607843137254943], [0.23529411764705888], [0.8156862745098039], [0.8980392156862745], [0.807843137254902], [0.027450980392156876], [0.6392156862745098], [0.8571568627450981], [0.7316666666666667], [0.1081372549019608], [0.0]], [[0.0], [0.0117647058823529], [0.019607843137254943], [0.6848756862745098], [0.84566], [0.9039180392156863], [0.8921533333333334], [0.9039180392156863], [0.8803886274509803], [0.9313690196078431], [0.8921533333333334], [0.9044835294117647], [0.9280129411764706], [0.44705882352941173], [0.0], [0.04313725490196085], [0.0117647058823529], [0.0], [0.27450980392156865], [0.8549019607843138], [0.8627450980392157], [0.7607843137254902], [0.03529411764705881], [0.6274509803921569], [0.8571568627450981], [0.7316666666666667], [0.09245098039215671], [0.0]], [[0.007843137254901933], [0.0], [0.015686274509804088], [0.641738431372549], [0.9515423529411765], [0.8843101960784314], [0.8999964705882353], [0.8843101960784314], [0.9078396078431372], [0.8921533333333334], [0.8647023529411765], [0.9044835294117647], [0.8848756862745099], [0.4862745098039216], [0.027450980392156876], [0.0], [0.0], [0.027450980392156876], [0.2941176470588235], [0.8313725490196078], [0.8901960784313725], [0.7490196078431373], [0.0235294117647058], [0.6705882352941177], [0.8846078431372549], [0.7630392156862745], [0.1081372549019608], [0.006176470588235228]], [[0.0], [0.0], [0.03137254901960773], [0.7005619607843137], [0.9044835294117647], [0.8921533333333334], [0.9039180392156863], [0.8843101960784314], [0.9005619607843137], [0.9005619607843137], [0.8927188235294118], [0.8966403921568628], [0.9162482352941177], [0.4770325490196079], [0.010365882352941114], [0.002805490196078342], [0.0], [0.0117647058823529], [0.19607843137254888], [0.8509803921568627], [0.8470588235294118], [0.7372549019607844], [0.007843137254901933], [0.5882352941176472], [0.8549019607843138], [0.7960784313725491], [0.12549019607843137], [0.0039215686274509665]], [[0.0], [0.0117647058823529], [0.05490196078431364], [0.7554639215686274], [0.9162482352941177], [0.8960749019607843], [0.9039180392156863], [0.8999964705882353], [0.8652678431372549], [0.9005619607843137], [0.8887972549019608], [0.8887972549019608], [0.9240913725490196], [0.4887972549019608], [0.002805490196078342], [0.014287450980392302], [0.0], [0.007843137254901933], [0.16862745098039222], [0.7960784313725491], [0.8784313725490196], [0.7254901960784313], [0.0117647058823529], [0.6352941176470588], [0.8862745098039215], [0.7647058823529411], [0.0980392156862745], [0.0039215686274509665]], [[0.0117647058823529], [0.0117647058823529], [0.05490196078431364], [0.8064443137254902], [0.8966403921568628], [0.8803886274509803], [0.8960749019607843], [0.9235258823529412], [0.9162482352941177], [0.9123266666666667], [0.8809541176470588], [0.8848756862745099], [0.9476207843137255], [0.5554639215686275], [0.002805490196078342], [0.002805490196078342], [0.0039215686274509665], [0.0039215686274509665], [0.1333333333333332], [0.7568627450980392], [0.9098039215686274], [0.7215686274509804], [0.0235294117647058], [0.6941176470588235], [0.9176470588235294], [0.7058823529411764], [0.05490196078431364], [0.0039215686274509665]], [[0.0], [0.0], [0.07450980392156858], [0.8652678431372549], [0.8966403921568628], [0.8921533333333334], [0.8921533333333334], [0.8725454901960784], [0.9084050980392157], [0.8809541176470588], [0.8809541176470588], [0.8731109803921568], [0.9240913725490196], [0.6025227450980393], [0.002805490196078342], [0.002805490196078342], [0.007843137254901933], [0.0], [0.11372549019607847], [0.7647058823529411], [0.9098039215686274], [0.7450980392156863], [0.03137254901960773], [0.7294117647058823], [0.9176470588235294], [0.6392156862745098], [0.0235294117647058], [0.0]], [[0.027450980392156876], [0.0], [0.1215686274509804], [0.8770325490196078], [0.8848756862745099], [0.9078396078431372], [0.9313690196078431], [0.9039180392156863], [0.8887972549019608], [0.8927188235294118], [0.9240913725490196], [0.8809541176470588], [0.9123266666666667], [0.637816862745098], [0.002805490196078342], [0.022130588235294013], [0.007843137254901933], [0.0], [0.10196078431372546], [0.7529411764705882], [0.8862745098039215], [0.7803921568627451], [0.039215686274509776], [0.7450980392156863], [0.8901960784313725], [0.5725490196078431], [0.007843137254901933], [0.0]], [[0.015686274509804088], [0.0], [0.1568627450980391], [0.8927188235294118], [0.9201698039215687], [0.8803886274509803], [0.8882317647058824], [0.8960749019607843], [0.9005619607843137], [0.9084050980392157], [0.8966403921568628], [0.8731109803921568], [0.9436992156862745], [0.7240913725490196], [0.033895294117647023], [0.002805490196078342], [0.0039215686274509665], [0.0], [0.07843137254901966], [0.6235294117647059], [0.8666666666666667], [0.807843137254902], [0.04705882352941182], [0.7725490196078432], [0.8705882352941177], [0.5215686274509804], [0.0039215686274509665], [0.0]], [[0.0], [0.0117647058823529], [0.25098039215686274], [0.8338952941176471], [0.9123266666666667], [0.8921533333333334], [0.8882317647058824], [0.8999964705882353], [0.8809541176470588], [0.9084050980392157], [0.8848756862745099], [0.8927188235294118], [0.8927188235294118], [0.7044835294117646], [0.10840509803921572], [0.002805490196078342], [0.0], [0.0039215686274509665], [0.039215686274509776], [0.3921568627450981], [0.8666666666666667], [0.8117647058823529], [0.05490196078431364], [0.8117647058823529], [0.8745098039215686], [0.4901960784313726], [0.0], [0.0]], [[0.0039215686274509665], [0.0117647058823529], [0.0], [0.041738431372548956], [0.002805490196078342], [0.002805490196078342], [0.013721960784313758], [0.002805490196078342], [0.002805490196078342], [0.018209019607843158], [0.002805490196078342], [0.014287450980392302], [0.002805490196078342], [0.05742470588235293], [0.002805490196078342], [0.029973725490195946], [0.0], [0.0039215686274509665], [0.0039215686274509665], [0.20392156862745092], [0.8784313725490196], [0.807843137254902], [0.05882352941176472], [0.8509803921568627], [0.8862745098039215], [0.4745098039215686], [0.0], [0.0]], [[0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0039215686274509665], [0.007843137254901933], [0.0], [0.19215686274509802], [0.8862745098039215], [0.807843137254902], [0.0862745098039216], [0.8784313725490196], [0.8745098039215686], [0.38431372549019605], [0.019607843137254943], [0.0]], [[0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0235294117647058], [0.23529411764705888], [0.8196078431372549], [0.6549019607843136], [0.027450980392156876], [0.7647058823529411], [0.8313725490196078], [0.3529411764705882], [0.0039215686274509665], [0.0]], [[0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.007843137254901933], [0.015686274509804088], [0.0], [0.0039215686274509665], [0.027450980392156876], [0.0], [0.0], [0.0], [0.0039215686274509665], [0.0039215686274509665], [0.0]], [[0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0117647058823529], [0.0], [0.0], [0.0117647058823529], [0.0], [0.0117647058823529], [0.0], [0.0], [0.0], [0.0], [0.0]]]])
print(loadImage.shape)

prediction = model.predict_classes(loadImage)
print(image_label_dict[str(prediction[0])])
predictions = model.predict_classes(img_test)
image_label_dict = {'0': 'T-shirt/top','1': 'Trouser', '2': 'Pullover', '3': 'Dress', '4': 'Coat', '5': 'Sandal', '6': 'Shirt', '7': 'Sneaker', 
                    '8': 'Bag', '9': 'Ankle boot'}

#Visualise a random image from test dataset, its predicted label and actual label
image_id = np.random.randint(0, img_test.shape[0])
print("Image Id: {}".format(image_id))
plt.imshow(img_test[image_id].reshape((28,28)), interpolation='nearest')
plt.title("Actual Label: {}, Predicted Label: {}({}%)".format(image_label_dict[str(label_test[image_id].argmax())], 
                                                              image_label_dict[str(predictions[image_id])], 
                                                np.round(model.predict(img_test[image_id].reshape((1, 28, 28, 1)))[0, predictions[image_id]]*100, 1)))
plt.show()
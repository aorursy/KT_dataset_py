# This Python 3 environment comes with many helpful analytics libraries installed
# It is defined by the kaggle/python docker image: https://github.com/kaggle/docker-python
# For example, here's several helpful packages to load in 

import numpy as np # linear algebra
import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)

# Input data files are available in the "../input/" directory.
# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory

import os
print(os.listdir("../input"))

# Any results you write to the current directory are saved as output.
train_df_merged=pd.read_csv('../input/elo-cards-predictive-modeling/train_df_merged_Merch.csv')
median_purch_lag3 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_purch_lag3.csv')
median_purch_lag6 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_purch_lag6.csv')
median_purch_lag12 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_purch_lag12.csv')
median_sales_lag3 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_sales_lag3.csv')
median_sales_lag6 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_sales_lag6.csv')
median_sales_lag12 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Median_sales_lag12.csv')
var_sales_lag3 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_sales_lag3.csv')
var_sales_lag6 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_sales_lag6.csv')
var_sales_lag12 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_sales_lag12.csv')
var_purch_lag3 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_purch_lag3.csv')
var_purch_lag6 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_purch_lag6.csv')
var_purch_lag12 = pd.read_csv('../input/combining-lag-features-1-and-2-files/Var_purch_lag12.csv')
New_median_purch_lag3 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_purch_lag3_byCard.csv')
New_median_purch_lag6 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_purchases_lag6_byCard.csv')
New_median_purch_lag12 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_purchases_lag12_byCard.csv')
New_var_purch_lag3 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_purch_lag3_byCard.csv')
New_var_purch_lag6 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_purchases_lag6_byCard.csv')
New_var_purch_lag12 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_purchases_lag12_byCard.csv')
New_median_sales_lag3 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_sales_lag3_byCard.csv')
New_median_sales_lag6 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_sales_lag6_byCard.csv')
New_median_sales_lag12 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Median_sales_lag12_byCard.csv')
New_var_sales_lag3 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_sales_lag3_byCard.csv')
New_var_sales_lag6 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_sales_lag6_byCard.csv')
New_var_sales_lag12 = pd.read_csv('../input/elo-cards-data-preprocessing/NewMerch_Var_sales_lag12_byCard.csv')
Merch_Median_purch_lag3_byCard_comb=pd.concat([median_purch_lag3,New_median_purch_lag3]).groupby(['card_id'])['avg_purchases_lag3'].mean().reset_index()
Merch_Median_purch_lag6_byCard_comb=pd.concat([median_purch_lag6,New_median_purch_lag6]).groupby(['card_id'])['avg_purchases_lag6'].mean().reset_index()
Merch_Median_purch_lag12_byCard_comb=pd.concat([median_purch_lag12,New_median_purch_lag12]).groupby(['card_id'])['avg_purchases_lag12'].mean().reset_index()
Merch_Var_purch_lag3_byCard_comb=pd.concat([var_purch_lag3,New_var_purch_lag3]).groupby(['card_id'])['avg_purchases_lag3'].sum().reset_index()
Merch_Var_purch_lag6_byCard_comb=pd.concat([var_purch_lag6,New_var_purch_lag6]).groupby(['card_id'])['avg_purchases_lag6'].sum().reset_index()
Merch_Var_purch_lag12_byCard_comb=pd.concat([var_purch_lag12,New_var_purch_lag12]).groupby(['card_id'])['avg_purchases_lag12'].sum().reset_index()
Merch_Median_sales_lag3_byCard_comb=pd.concat([median_sales_lag3,New_median_sales_lag3]).groupby(['card_id'])['avg_sales_lag3'].mean().reset_index()
Merch_Median_sales_lag6_byCard_comb=pd.concat([median_sales_lag6,New_median_sales_lag6]).groupby(['card_id'])['avg_sales_lag6'].mean().reset_index()
Merch_Median_sales_lag12_byCard_comb=pd.concat([median_sales_lag12,New_median_sales_lag12]).groupby(['card_id'])['avg_sales_lag12'].mean().reset_index()
Merch_Var_sales_lag3_byCard_comb=pd.concat([var_sales_lag3,New_var_sales_lag3]).groupby(['card_id'])['avg_sales_lag3'].sum().reset_index()
Merch_Var_sales_lag6_byCard_comb=pd.concat([var_sales_lag6,New_var_sales_lag6]).groupby(['card_id'])['avg_sales_lag6'].sum().reset_index()
Merch_Var_sales_lag12_byCard_comb=pd.concat([var_sales_lag12,New_var_sales_lag12]).groupby(['card_id'])['avg_sales_lag12'].sum().reset_index()
Merch_Median_sales_lag3_byCard_comb['avg_sales_lag3'].max()
train_df_merged=pd.merge(Merch_Median_purch_lag3_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Median_purch_lag6_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Median_purch_lag12_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_purch_lag3_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_purch_lag6_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_purch_lag12_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Median_sales_lag3_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Median_sales_lag6_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Median_sales_lag12_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_sales_lag3_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_sales_lag6_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged=pd.merge(Merch_Var_sales_lag12_byCard_comb , train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
New_Median_Amt_card=pd.read_csv('../input/elo-cards-data-preprocessing/MedianAmt_by_Card_NewMerch.csv')
New_Var_Amt_card=pd.read_csv('../input/elo-cards-data-preprocessing/VarAmt_by_Card_NewMerch.csv')
New_Median_instal_card=pd.read_csv('../input/elo-cards-data-preprocessing/Median_instal_by_card.csv')

New_Median_Amt_card['purchase_amount'].max()
Median_Amt_card=pd.read_csv('../input/elo-cards-adding-more-features/MedianAmt_by_Card_Merch.csv')
Var_Amt_card=pd.read_csv('../input/elo-cards-adding-more-features/VarAmt_by_Card_Merch.csv')
Median_instal_card=pd.read_csv('../input/fork-of-fork-of-fork-of-elo-cards-data-pre-6dcb4e/Median_instal_by_card.csv')
Median_Amt_card['purchase_amount'].max()
Median_Amt_card_comb=pd.concat([Median_Amt_card,New_Median_Amt_card]).groupby(['card_id'])['purchase_amount'].mean().reset_index()
Var_Amt_card_comb=pd.concat([Var_Amt_card,New_Var_Amt_card]).groupby(['card_id'])['purchase_amount'].sum().reset_index()
Median_instal_card_comb=pd.concat([Median_instal_card,New_Median_instal_card]).groupby(['card_id'])['installments'].mean().reset_index()
Median_Amt_card_comb['purchase_amount'].max()
Median_Amt_card_comb.head()
#train_df_merged=pd.merge(Median_Amt_card_comb, train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged = train_df_merged.merge(Median_Amt_card_comb, how='left', on = ['card_id'])
train_df_merged = train_df_merged.merge(Var_Amt_card_comb, how='left', on = ['card_id'])
train_df_merged = train_df_merged.merge(Median_instal_card_comb, how='left', on = ['card_id'])
train_df_merged.fillna(0, inplace=True)
#train_df_merged=pd.merge(Var_Amt_card_comb, train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
#train_df_merged=pd.merge(Median_instal_card_comb, train_df_merged, how = 'inner', left_on = ['card_id'], right_on=['card_id'])
train_df_merged['purchase_amount_x'].max()
train_df_merged = train_df_merged.rename(columns={'purchase_amount_x': 'Median_purch_amt'})
train_df_merged = train_df_merged.rename(columns={'purchase_amount_y': 'Variance_purch_amt'})
train_df_merged = train_df_merged.rename(columns={'installments_x': 'Median_installments'})
train_df_merged.head()
train_df_merged['Median_purch_amt'].max()
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag3_x': 'Median_avg_sales_lag3'})
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag6_x': 'Median_avg_sales_lag6'})
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag12_x': 'Median_avg_sales_lag12'})
train_df_merged['Median_avg_sales_lag3'].max()
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag3_y': 'Variance_avg_sales_lag3'})
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag6_y': 'Variance_avg_sales_lag6'})
train_df_merged = train_df_merged.rename(columns={'avg_sales_lag12_y': 'Variance_avg_sales_lag12'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag3_x': 'Median_avg_purchases_lag3'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag6_x': 'Median_avg_purchases_lag6'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag12_x': 'Median_avg_purchases_lag12'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag3_y': 'Variance_avg_purchases_lag3'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag6_y': 'Variance_avg_purchases_lag6'})
train_df_merged = train_df_merged.rename(columns={'avg_purchases_lag12_y': 'Variance_avg_purchases_lag12'})
train_df_merged.head()
train_df_merged=train_df_merged.drop('Unnamed: 0',axis=1)
len(train_df_merged)
train_df_merged.to_csv('train_df_merged_V1.csv')
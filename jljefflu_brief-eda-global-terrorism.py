import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import warnings
warnings.filterwarnings('ignore')
sns.set_style('whitegrid')
%matplotlib inline
df = pd.read_csv('../input/globalterrorismdb_0718dist.csv', engine ='python')
df = df[['iyear','imonth','iday','extended','country_txt','region_txt','attacktype1_txt','city','targtype1_txt','nkill','nwound','gname']]
df['casualties'] = df['nkill'] + df['nwound']
df.head()
plt.figure(figsize=(15,6))
sns.countplot(df['iyear'],palette='icefire')
plt.xticks(rotation = 90)
plt.title('Number of Terrorist Attacks By Year');
plt.xlabel('Year')
plt.show()
plt.figure(figsize=(13,6))
sns.countplot(df['attacktype1_txt'],data=df,order=df['attacktype1_txt'].value_counts().index,
              palette='hot')
plt.xticks(rotation=90)
plt.xlabel('Method')
plt.title('Method of Attack')
plt.show()
fig,axes = plt.subplots(figsize=(16,11),nrows=1,ncols=2)
sns.barplot(x = df['country_txt'].value_counts()[:20].values, y = df['country_txt'].value_counts()[:20].index, 
            ax=axes[0],palette = 'magma');
axes[0].set_title('Terrorist Attacks per Country')
sns.barplot(x=df['region_txt'].value_counts().values,y=df['region_txt'].value_counts().index,
            ax=axes[1])
axes[1].set_title('Terrorist Attacks per Region')
fig.tight_layout()
plt.show()
plt.subplots(figsize=(11,10))
sns.barplot(y=df['gname'].value_counts()[1:12].index,x=df['gname'].value_counts()[1:12].values,
           palette='copper')
plt.title('Most Active Terrorist Organizations')
plt.show()
plt.subplots(figsize=(15,7))
sns.barplot(y=df['targtype1_txt'].value_counts().index,x=df['targtype1_txt'].value_counts().values,
           palette='tab10')
plt.title('Most Affected Targets')
plt.show()
fig,axes = plt.subplots(figsize=(16,8))
avg_casualties = df.groupby('iyear').mean()['casualties']
avg_casualties.plot.bar(color='grey')
plt.xlabel('Year')
plt.ylabel('Average Number of Casualties')
plt.title('Average Number of Casualties per Year')
plt.hlines(y=avg_casualties.loc[1998],colors='red',xmin=-4,xmax=27,linestyles='--')
plt.hlines(y=avg_casualties.loc[2001],colors='red',xmin=-4,xmax=30,linestyles='--')
plt.hlines(y=avg_casualties.loc[2004],colors='red',xmin=33,xmax=50,linestyles='--')
plt.text(10, 13, '1998: 13.75',fontsize=12,bbox=dict(facecolor='red', alpha=0.4))
plt.text(12, 15.8, '2001: 16.51',fontsize=12,bbox=dict(facecolor='red', alpha=0.4))
plt.text(37, 15.3, '2004: 16.11 ',fontsize=12,bbox=dict(facecolor='red', alpha=0.4))
plt.show()
df_after = df[df['iyear']>=2001]
fig,ax = plt.subplots(figsize=(15,10),nrows=2,ncols=1)
ax[0] = pd.crosstab(df.iyear,df.region_txt).plot(ax=ax[0])
ax[0].set_title('Change in Regions per Year')
ax[0].legend(loc='center left',bbox_to_anchor = (1,0.5))
ax[0].vlines(x=2001,ymin=0,ymax=7000,colors='red',linestyles='--')
pd.crosstab(df_after.iyear,df_after.region_txt).plot.bar(stacked=True,ax=ax[1])
ax[1].set_title('After Declaration of War on Terror (2001-2017)')
ax[1].legend(loc='center left',bbox_to_anchor = (1,0.5))
plt.show()
fig,axes = plt.subplots(figsize=(15,6))
sns.lineplot(df[df['region_txt']=='Western Europe']['iyear'].value_counts().index,
             df[df['region_txt']=='Western Europe']['iyear'].value_counts().values)
sns.lineplot(df[df['region_txt']=='Eastern Europe']['iyear'].value_counts().index,
             df[df['region_txt']=='Eastern Europe']['iyear'].value_counts().values)
plt.xlabel('Year')
plt.xticks(np.arange(1970,2017,5))
plt.xlim(1970,2017)
plt.ylabel('Number of Attacks')
plt.title('Western vs Eastern Europe')
axes.legend(labels=['Western Europe','Eastern Europe'])
plt.show()
fig,ax = plt.subplots(figsize=(15,6))
russia = df[(df['country_txt']=='Russia') & (df['iyear'].between(1991,2017,inclusive=True))]['iyear'].value_counts()
ukraine = df[(df['country_txt']=='Ukraine') & (df['iyear'].between(1991,2017,inclusive=True))]['iyear'].value_counts()
rest_east = df[(df['country_txt']!='Russia') & (df['country_txt']!='Ukraine')
               & (df['region_txt']=='Eastern Europe')& (df['iyear'].between(1991,2017,inclusive=True))]['iyear'].value_counts()
sns.lineplot(x=russia.index,y=russia.values)
sns.lineplot(x=ukraine.index,y=ukraine.values)
sns.lineplot(x=rest_east.index,y=rest_east.values)
plt.xticks(np.arange(1991,2017,1))
plt.xlim(1991,2017)
plt.xlabel('Year')
plt.ylabel('Number of Attacks')
plt.title('Russia and Ukraine vs Rest of Eastern Europe(1991-2017)')
ax.legend(labels=['Russia','Ukraine','Rest of Eastern Europe'])
plt.show()
fig,ax = plt.subplots(figsize=(15,6),nrows=1,ncols=2)
ax[0]=df[df['extended']==1].groupby('attacktype1_txt').count()['extended'].sort_values().plot.barh(color='red',ax=ax[0])
ax[1]=df[df['extended']==0].groupby('attacktype1_txt').count()['extended'].sort_values().plot.barh(color='blue',ax=ax[1])
ax[0].set_title('Number of Extended Attacks')
ax[0].set_ylabel('Method')
ax[1].set_title('Number of Unextended Attacks')
ax[1].set_ylabel('Method')
plt.tight_layout()
plt.show()
fig,axes = plt.subplots(figsize=(15,5))
ext_casualties = df[df['extended']==1].groupby('iyear').mean()['casualties']
ext_casualties.plot()
unext_casualties = df[df['extended']==0].groupby('iyear').mean()['casualties']
unext_casualties.plot()
plt.title('Extended vs Unextended Attacks')
plt.xlabel('year')
plt.xlim(1970,2017)
plt.xticks(np.arange(1970,2017,5))
plt.ylabel('Average Number of Casualties')
plt.hlines(y=ext_casualties.mean(),colors='red',xmin=1970,xmax=2017,linestyles='--')
plt.hlines(y=unext_casualties.mean(),colors='red',xmin=1970,xmax=2017,linestyles='--')
plt.text(2018, 3, 'Extended:3.27',fontsize=12,bbox=dict(facecolor='red', alpha=0.4))
plt.text(2018, 5.1, 'Unextended:5.48',fontsize=12,bbox=dict(facecolor='red', alpha=0.4))
axes.legend(labels=['Extended','Unextended'],loc='upper left')
plt.show()